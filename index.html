<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FIFA Draft & Match</title>

<style>
body {
  margin: 0;
  background: #0b0b0b;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}
h1, h2 { margin: 14px 0 6px; }

/* ---------- PACK ---------- */
.pack {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 10px;
  max-width: 360px;
  margin: auto;
}
.pack img {
  width: 100%;
  max-width: 90px;
  border-radius: 8px;
  cursor: pointer;
}

/* ---------- TEAMS ---------- */
.team {
  max-width: 360px;
  margin: auto;
  padding-bottom: 12px;
}
.row {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin: 5px 0;
}
.slot {
  width: 85px;
  height: 130px;
  border: 2px dashed #555;
  border-radius: 8px;
}
.slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

button {
  margin: 16px;
  padding: 12px 20px;
  font-size: 16px;
  background: #1db954;
  border: none;
  border-radius: 6px;
  color: black;
  cursor: pointer;
}
#result { font-size: 18px; margin-bottom: 20px; }
.small { opacity: 0.85; font-size: 12px; margin-top: 4px; }
</style>
</head>

<body>

<h1>PACK</h1>
<div class="pack" id="pack"></div>
<div class="small" id="turnInfo"></div>

<h2>TEAM A</h2>
<div class="team" id="teamA"></div>

<h2>TEAM B</h2>
<div class="team" id="teamB"></div>

<button id="playBtn">PLAY MATCH</button>
<div id="result"></div>

<script>
/* =========================================================
   1) ADD YOUR CARDS + RATINGS HERE (MANUAL DATABASE)
   Key = image path in your repo
   rating = the real rating you want that card to have
   ========================================================= */
const CARD_DB = {
  "fifa-cards/marcelo10.png": { rating: 92 },
  "fifa-cards/marcelo11.png": { rating: 93 },
  "fifa-cards/marcelo12.png": { rating: 94 },
  "fifa-cards/marcelo13.png": { rating: 95 },

  "fifa-cards/vieira10.png": { rating: 94 },
  "fifa-cards/vieira11.png": { rating: 95 },
  "fifa-cards/vieira12.png": { rating: 96 },
  "fifa-cards/vieira14.png": { rating: 97 },

  "fifa-cards/buffon10.png": { rating: 94 },
  "fifa-cards/neuer10.png": { rating: 93 },

  "fifa-cards/messi10.png": { rating: 99 },
  "fifa-cards/cristianoronaldo10.png": { rating: 98 },

  // ‚úÖ KEEP ADDING YOUR OWN...
  // "fifa-cards/henry14.png": { rating: 96 },
};

/* Build the card list automatically from the database */
const allCards = Object.keys(CARD_DB);

/* ---------- SETTINGS ---------- */
const PACK_SIZE = 6;     // you wanted 6
const PICKS_PER_PACK = 2; // 1 pick Team A + 1 pick Team B each pack
const TEAM_SIZE = 11;     // 11 players per team

/* ---------- STATE ---------- */
let deck = [...allCards];
let packCards = [];
let selectedCard = null;
let picksThisRound = 0;
let currentTeam = "A";

const teamAPlayers = [];
const teamBPlayers = [];

/* ---------- ELEMENTS ---------- */
const packEl = document.getElementById("pack");
const teamAEl = document.getElementById("teamA");
const teamBEl = document.getElementById("teamB");
const resultEl = document.getElementById("result");
const playBtn = document.getElementById("playBtn");
const turnInfo = document.getElementById("turnInfo");

/* ---------- HELPERS ---------- */
function shuffle(arr) {
  // Fisher-Yates
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function getRating(cardPath) {
  return CARD_DB[cardPath]?.rating ?? 75; // fallback if you forgot to add one
}

function updateTurnInfo() {
  const needA = TEAM_SIZE - teamAPlayers.length;
  const needB = TEAM_SIZE - teamBPlayers.length;
  turnInfo.textContent =
    `Pick for Team ${currentTeam} ‚Ä¢ Remaining: Team A ${needA}, Team B ${needB}`;
}

/* ---------- FORMATION ---------- */
function buildTeam(teamEl) {
  teamEl.innerHTML = "";
  const rows = [3,3,4,1]; // 4-3-3 + GK

  rows.forEach(count => {
    const row = document.createElement("div");
    row.className = "row";

    for (let i = 0; i < count; i++) {
      const slot = document.createElement("div");
      slot.className = "slot";
      slot.onclick = () => placeCard(slot);
      row.appendChild(slot);
    }
    teamEl.appendChild(row);
  });
}

/* ---------- PACK ---------- */
function dealPack() {
  packEl.innerHTML = "";
  selectedCard = null;
  picksThisRound = 0;
  currentTeam = "A";

  if (deck.length === 0) {
    packEl.innerHTML = "<div style='grid-column:1/-1;padding:14px;'>No cards left</div>";
    updateTurnInfo();
    return;
  }

  // Shuffle deck each new pack (keeps it feeling random)
  shuffle(deck);

  // Take up to PACK_SIZE
  packCards = deck.slice(0, Math.min(PACK_SIZE, deck.length));

  packCards.forEach(src => {
    const img = document.createElement("img");
    img.src = src;
    img.alt = src;
    img.onclick = () => selectCard(img);
    packEl.appendChild(img);
  });

  updateTurnInfo();
}

function selectCard(img) {
  selectedCard = img.src;

  // Reset opacity then dim selected
  [...packEl.children].forEach(i => i.style.opacity = 1);
  img.style.opacity = 0.4;
}

/* ---------- DRAFT PLACEMENT ---------- */
function placeCard(slot) {
  if (!selectedCard) return;
  if (slot.innerHTML !== "") return;

  // prevent picking after team full
  if (currentTeam === "A" && teamAPlayers.length >= TEAM_SIZE) return;
  if (currentTeam === "B" && teamBPlayers.length >= TEAM_SIZE) return;

  // Place image in slot
  const img = document.createElement("img");
  img.src = selectedCard;
  slot.appendChild(img);

  // Record pick
  if (currentTeam === "A") teamAPlayers.push(selectedCard);
  else teamBPlayers.push(selectedCard);

  // Remove from deck entirely so it can't reappear
  deck = deck.filter(c => c !== selectedCard);

  // Also remove from current pack UI by re-dealing replacement into the same pack:
  // Instead of replacing only one card, your current design re-deals after 2 picks.
  // We'll keep that behavior: after 2 picks, new pack.
  selectedCard = null;
  picksThisRound++;

  // Switch team turn
  currentTeam = currentTeam === "A" ? "B" : "A";
  updateTurnInfo();

  // After both teams have picked (2 picks), show a fresh pack
  if (picksThisRound === PICKS_PER_PACK) {
    dealPack();
  }

  // Enable match only when both complete
  if (teamAPlayers.length === TEAM_SIZE && teamBPlayers.length === TEAM_SIZE) {
    playBtn.disabled = false;
  }
}

/* ---------- MATCH SIM (simple but weighted) ---------- */
function teamPower(team) {
  return team.reduce((sum, card) => sum + getRating(card), 0);
}

function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

function playMatch() {
  if (teamAPlayers.length < TEAM_SIZE || teamBPlayers.length < TEAM_SIZE) {
    alert("Both teams must have 11 players first.");
    return;
  }

  const powerA = teamPower(teamAPlayers);
  const powerB = teamPower(teamBPlayers);

  // Convert power into expected goals with randomness
  // Higher power -> slightly higher chance & more goals
  const baseA = powerA / (TEAM_SIZE * 100); // around 0.75‚Äì1.05 typically
  const baseB = powerB / (TEAM_SIZE * 100);

  // Simple Poisson-ish goals
  const goalsA = clamp(Math.round((baseA * 2.2) + (Math.random() * 2.2)), 0, 7);
  const goalsB = clamp(Math.round((baseB * 2.2) + (Math.random() * 2.2)), 0, 7);

  const winner =
    goalsA > goalsB ? "TEAM A WINS üèÜ" :
    goalsB > goalsA ? "TEAM B WINS üèÜ" :
    "DRAW ü§ù";

  resultEl.innerHTML = `
    <div style="margin:8px 0;">Team Strength: A ${powerA} vs B ${powerB}</div>
    <div style="font-size:22px;margin:10px 0;"><strong>Team A ${goalsA} ‚Äì ${goalsB} Team B</strong></div>
    <div style="margin:6px 0;">${winner}</div>
  `;
}

/* ---------- INIT ---------- */
buildTeam(teamAEl);
buildTeam(teamBEl);
dealPack();

playBtn.onclick = playMatch;
playBtn.disabled = true;
</script>

</body>
</html>
